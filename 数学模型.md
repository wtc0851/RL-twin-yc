# 自动化码头双场桥动态调度数学模型

## 1. 问题描述

本文研究自动化集装箱码头海侧/路侧交互模式下的双场桥（Dual Yard Cranes, DYC）动态调度问题。系统包含一个由 $B$ 个贝位（Bay）组成的箱区和两台在同一轨道上运行的场桥（分别记为 $YC_1$ 和 $YC_2$）。$YC_1$ 位于箱区左侧（小贝位号方向），$YC_2$ 位于箱区右侧（大贝位号方向）。由于共用同一条轨道，两台场桥在物理位置上不可交换顺序，且必须始终保持最小安全距离。

装卸任务随着集卡（或AGV）的到达动态生成。每个任务 $j$ 具有生成时间、目标贝位位置和处理时间。调度系统的目标是在满足时空约束的前提下，实时为两台场桥分配任务并规划作业顺序，以最小化任务平均等待时间和场桥无效移动成本。

## 2. 符号定义

为了建立严谨的数学模型，定义如下集合、参数和决策变量。

### 2.1 集合与索引

| 符号 | 描述 |
| :--- | :--- |
| $i$ | 场桥索引，$i \in \{1, 2\}$，其中 1 代表左侧场桥，2 代表右侧场桥 |
| $J$ | 待调度任务集合，$J = \{1, 2, \dots, N\}$ |
| $j, k$ | 任务索引，$j, k \in J$ |
| $0$ | 虚拟起始节点，代表场桥的初始状态 |
| $J^+$ | 包含虚拟起始节点的任务集合，$J^+ = J \cup \{0\}$ |

### 2.2 系统参数

| 符号 | 描述 | 单位 |
| :--- | :--- | :--- |
| $L_j$ | 任务 $j$ 的作业位置（贝位号） | Bay |
| $T^{avail}_j$ | 任务 $j$ 的可用时间（集卡到达时间），即任务可以开始的最早时间 | s |
| $T^{proc}_j$ | 任务 $j$ 的作业耗时（包含抓取、提升、放置等） | s |
| $v$ | 场桥移动速度 | Bay/s |
| $d_{safe}$ | 两台场桥之间的最小安全距离 | Bay |
| $L^{init}_i$ | 场桥 $i$ 的初始位置 | Bay |
| $\alpha$ | 目标函数中任务等待时间的权重系数 | - |
| $\beta$ | 目标函数中场桥移动成本的权重系数 | - |
| $M$ | 一个足够大的正数（Big-M） | - |

### 2.3 决策变量

**二进制变量：**

| 符号 | 描述 |
| :--- | :--- |
| $x_{ij}$ | 若场桥 $i$ 执行任务 $j$，则为 1；否则为 0 |
| $y_{ijk}$ | 若场桥 $i$ 连续执行任务 $j$ 和任务 $k$（即 $j$ 是 $k$ 的紧前任务），则为 1；否则为 0 |
| $z_{jk}$ | 若任务 $j$ 在任务 $k$ 之前开始执行，则为 1；否则为 0（用于处理干扰任务的时序） |

**连续变量：**

| 符号 | 描述 | 单位 |
| :--- | :--- | :--- |
| $S_j$ | 任务 $j$ 的开始作业时刻 | s |
| $C_j$ | 任务 $j$ 的完成时刻 | s |
| $W_j$ | 任务 $j$ 的等待时间 | s |

## 3. 数学模型构建

### 3.1 目标函数

模型的优化目标是最小化任务的总等待时间和场桥的总移动距离（移动成本）。

$$
\min Z = \alpha \sum_{j \in J} (S_j - T^{avail}_j) + \beta \sum_{i \in I} \sum_{j \in J^+} \sum_{k \in J} y_{ijk} \cdot |L_j - L_k|
$$

其中：
- 第一项表示所有任务的等待时间之和，即任务实际开始时间 $S_j$ 与集卡到达时间 $T^{avail}_j$ 的差值。
- 第二项表示场桥完成所有任务序列的总移动距离。对于虚拟起始节点 $0$，令 $L_0 = L^{init}_i$。

### 3.2 约束条件

#### 3.2.1 任务分配与流守恒约束

每个任务必须且只能被一台场桥执行一次：

$$
\sum_{i \in I} x_{ij} = 1, \quad \forall j \in J
$$

场桥的任务执行顺序必须满足流平衡（每个任务只有一个紧前任务和一个紧后任务，除首尾外）：

$$
\sum_{j \in J^+} y_{ijk} = x_{ik}, \quad \forall k \in J, \forall i \in I
$$

$$
\sum_{k \in J} y_{ijk} \le 1, \quad \forall j \in J^+, \forall i \in I
$$

$$
x_{ij} = \sum_{k \in J} y_{ijk} + \mathbb{I}(j \text{ is last}), \quad \forall j \in J, \forall i \in I
$$

#### 3.2.2 时间窗与作业逻辑约束

任务必须在集卡到达（可用）之后才能开始：

$$
S_j \ge T^{avail}_j, \quad \forall j \in J
$$

任务的完成时间等于开始时间加上作业耗时：

$$
C_j = S_j + T^{proc}_j, \quad \forall j \in J
$$

若任务 $j$ 和 $k$ 由同一台场桥连续执行（$y_{ijk}=1$），则任务 $k$ 的开始时间必须晚于任务 $j$ 的完成时间加上场桥移动时间：

$$
S_k \ge C_j + \frac{|L_j - L_k|}{v} - M(1 - y_{ijk}), \quad \forall j \in J^+, \forall k \in J, \forall i \in I
$$

#### 3.2.3 空间防碰撞约束（重点）

由于两台场桥共用轨道且 $YC_1$ 始终位于 $YC_2$ 左侧，任何时刻 $t$ 两台场桥的物理位置 $P_1(t)$ 和 $P_2(t)$ 必须满足：

$$
P_1(t) + d_{safe} \le P_2(t)
$$

在任务调度层面，这转化为以下约束：

**（1）作业位置的空间兼容性**

如果 $YC_1$ 执行任务 $j$，$YC_2$ 执行任务 $k$，且两者的作业位置不满足安全距离（即 $L_j + d_{safe} > L_k$），则这两个任务在时间上不能重叠，必须错开执行。定义冲突任务对集合 $\Psi = \{(j, k) | L_j + d_{safe} > L_k, j \in J, k \in J\}$。

对于任意 $(j, k) \in \Psi$：

$$
S_k \ge C_j - M(3 - x_{1j} - x_{2k} - z_{jk})
$$

$$
S_j \ge C_k - M(2 - x_{1j} - x_{2k} + z_{jk})
$$

上述约束表明：当 $YC_1$ 做 $j$ 且 $YC_2$ 做 $k$ 且位置冲突时，要么 $j$ 先做完（$z_{jk}=1$），要么 $k$ 先做完（$z_{jk}=0$）。

**（2）避让移动约束**

仅时间上的错开是不够的，还需要确保等待的一方已经移动到了安全区域。
若 $YC_1$ 正在执行任务 $j$，则 $YC_2$ 必须位于 $L_j + d_{safe}$ 及其右侧；若 $YC_2$ 正在执行任务 $k$，则 $YC_1$ 必须位于 $L_k - d_{safe}$ 及其左侧。

如果任务 $j$ ($YC_1$) 和任务 $k$ ($YC_2$) 冲突（$(j, k) \in \Psi$），且 $j$ 先执行（$z_{jk}=1$），则 $YC_2$ 在 $j$ 完成前不能开始移动进入冲突区域，或者必须在安全区域等待。简化的充分非必要约束为：

$$
S_k \ge C_j + \frac{\max(0, L_k - (L_j + d_{safe}))}{v} - M(3 - x_{1j} - x_{2k} - z_{jk})
$$

这意味着如果 $YC_1$ 先做 $j$，那么 $YC_2$ 开始做 $k$ 的时间不仅要晚于 $j$ 完成，还要考虑 $YC_1$ 撤离或 $YC_2$ 驶入的时间。

## 4. 动态调度机制

由于实际场景中任务是动态到达的，上述模型采用**滚动时域控制（Rolling Horizon Control, RHC）**策略进行求解：
1.  在时刻 $t$，获取当前已到达但未完成的任务以及预测即将到达的任务构成集合 $J_t$。
2.  求解上述混合整数规划（MIP）模型，得到最优调度方案。
3.  场桥执行当前分配的第一个任务。
4.  当有新任务到达或当前任务完成时，更新系统状态，重复步骤 1-3。

---
**注**：本模型未包含仿真特定的参数（如最大仿真时间），而是通用的动态调度优化模型。所有变量和参数均在符号表中定义。